<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.0">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>开篇简述 | zhanyd的博客</title><meta name="description" content="欢迎来到zhanyd的博客">
    <link rel="preload" href="/assets/style-pBmjJHNx.css" as="style"><link rel="stylesheet" href="/assets/style-pBmjJHNx.css">
    <link rel="modulepreload" href="/assets/app-2vfNvOO_.js"><link rel="modulepreload" href="/assets/攻防演练思考.html-vPmLXvdb.js"><link rel="modulepreload" href="/assets/攻防演练思考.html-RXNMNSOb.js">
    <link rel="prefetch" href="/assets/index.html-IpVBfRG1.js" as="script"><link rel="prefetch" href="/assets/index.html-u2quizcP.js" as="script"><link rel="prefetch" href="/assets/index.html-VN_MR_5J.js" as="script"><link rel="prefetch" href="/assets/网络安全实战攻防演练丨防守方案经验分享.html-tcq7v8G1.js" as="script"><link rel="prefetch" href="/assets/404.html-r6aI8Oiv.js" as="script"><link rel="prefetch" href="/assets/index.html-LUdW6sIX.js" as="script"><link rel="prefetch" href="/assets/index.html-yRNme6Xs.js" as="script"><link rel="prefetch" href="/assets/index.html-JRw8ARWH.js" as="script"><link rel="prefetch" href="/assets/网络安全实战攻防演练丨防守方案经验分享.html-hwNt63ES.js" as="script"><link rel="prefetch" href="/assets/404.html-TtiIHF7M.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">zhanyd的博客</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/network/" class="router-link-active" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/designPatterns/" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/network/" class="router-link-active" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/designPatterns/" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">网络 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/network/攻防演练思考.md" class="sidebar-item active" aria-label="攻防演练思考"><!--[--><!--]--> 攻防演练思考 <!--[--><!--]--></a><!----></li><li><a href="/network/网络安全实战攻防演练丨防守方案经验分享.md" class="sidebar-item" aria-label="网络安全实战攻防演练丨防守方案经验分享"><!--[--><!--]--> 网络安全实战攻防演练丨防守方案经验分享 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="开篇简述" tabindex="-1"><a class="header-anchor" href="#开篇简述" aria-hidden="true">#</a> 开篇简述</h1><ol><li><p>渗透的本质就是信息收集</p><ul><li>外围打点的信息收集是目标的资产范围</li><li>内网收集的是凭据、票据（通俗的讲，就是密码）以及网段、C段</li></ul></li><li><p>目标行业（不是绝对情况）。</p><ol><li>大致有两种（机关单位、集团公司）</li><li>机关单位的资产相对集中。</li><li>集团公司的资产相对散落。</li></ol></li><li><p>目标的资产具有一定的有时效性。</p><ol><li>大致有三种情况。</li><li>一种是目标资产依然存在。</li><li>另外一种是已经不存在了。</li><li>还有一种是虽然资产依然存在，但是资产不在原来的IP、域名或端口。</li></ol></li><li><p>攻防演练中还有一种很极端的情况，那就是在你授权期间，资产是彻底关闭的，你授权期一过，资产又重新开放。</p></li><li><p>攻防的体系（ATT&amp;CK）是知识点的串联（要自身去查漏补缺）</p><ul><li>你的知识面决定了，你的渗透面。</li><li>而自身知识体系的完善度，则决定了你渗透面的深度。</li></ul></li><li><p>基础漏洞应该由工具来完成（Goby、Xray）</p><ul><li>Goby针对资产去扫描</li><li>Xray针对漏洞去扫描</li><li>工具有很多，如果你还不能编写属于自己的工具，那么现在要先学着去使用它们。</li></ul></li><li><p>红蓝对抗层面由人的思路来解决</p><ul><li>邮件钓鱼</li><li>溯源反制</li><li>远控木马免杀</li><li>恶意代码分析</li></ul></li><li><p>攻防演练（国家级）</p><ul><li><p>红队需要做到流量隐蔽</p><ul><li>最少的请求，精准的Payload</li></ul></li><li><p>蓝队需要做到处置响应</p></li></ul></li><li><p>攻击IP不能是自己的电脑</p><ol><li>只能是云服务器，或者其他地区的IP。</li><li>将所有的攻击操作交给云服务器，或者其他IP。</li><li>因为你自己的IP，被封了。</li><li>对后续的渗透会产生巨大的影响。</li><li>想一想，假设你的电脑不能访问目标的所有网站，</li><li>那你如何能继续分析下去。</li><li>请谨记，攻击流量不能从本机IP发出。</li></ol></li><li><p>请养成制作资产清单的习惯（必须做这件事）</p></li></ol><h2 id="快速打点" tabindex="-1"><a class="header-anchor" href="#快速打点" aria-hidden="true">#</a> 快速打点</h2><p>注：2020年的时候，我还相信快速打点，但是现在随着一轮又一轮的Hvv，点越来越少。</p><ol><li>明确目标的广度和深度 <ul><li>广度：边界、范围</li><li>深度：目的</li></ul></li><li>准备好工具 <ul><li>VPS</li><li>免杀木马</li><li>Payload</li><li>漏扫工具</li></ul></li><li>粗略信息收集 <ul><li>输出资产表，不需要太详细</li><li>主要是先简单了解目标的资产情况</li></ul></li><li>针对突出且暴露的攻击面 <ol><li>主要是针对技术框架：某CMS、某管理系统、某语言的框架</li><li>主要观察高发漏洞的：织梦CMS、通达、Spring Boot</li><li>打Payload验证。</li></ol></li><li>第四步无效后，再做一次详细的信息收集 <ul><li>之所以一开始不详细收集目标信息，主要是要突出快速打点。</li></ul></li><li>信息收集要求【用Excel表格展示】 <ul><li>全面、准确、时效、清晰</li><li>目标网站展示的内容、功能点也要注意，不要总是把目光放在IP、域名这些东西上。</li><li>Excel表格 <ul><li>IP、域名、子域名、端口、URL</li><li>指纹、特征、框架、备注</li></ul></li></ul></li></ol><h2 id="被动信息收集" tabindex="-1"><a class="header-anchor" href="#被动信息收集" aria-hidden="true">#</a> 被动信息收集</h2><p>从第三方的信息收集机构或者平台得到信息，不与目标直接接触。</p><ul><li>https://fofa.info/</li><li>https://hunter.qianxin.com/</li><li>https://x.threatbook.com/</li><li>https://ti.360.net/#/homepage</li><li>http://finger.tidesec.net/</li></ul><h2 id="主动信息收集" tabindex="-1"><a class="header-anchor" href="#主动信息收集" aria-hidden="true">#</a> 主动信息收集</h2><p>明确目标：一定要是目标的真实IP，而不是CDN。</p><p>信息收集：字典是重中之重，最好自己收集，自行分类。</p><p>进阶方式：自己写工具，自己写Payload，自己去代码审计。</p><p>端口扫描：Nmap、Masscan、Goby。</p><p>信息处理：对信息分类、对信息再做一次扩展、对信息进行整合</p><p>漏扫工具：Xray、Nuclei、Vulmap</p><p>传统工具：AWVS、Nessus、APPScan</p><p>WAF识别：wafw00f</p><h1 id="内网简述" tabindex="-1"><a class="header-anchor" href="#内网简述" aria-hidden="true">#</a> 内网简述</h1><ol><li>虽然MSF和CS都是很优秀的工具，但是国内的安全厂商都把这两个工具研究透了。对这两个工具的流量特征非常了解，所有功能的操作特征，都研究的非常透彻。</li><li>红队需要流量隐匿，我小学那会看过黑客类的小说，所有的工具都是主角自己写的。如果所有工具都是自己写的，那将成神。</li></ol><h2 id="上线的权衡" tabindex="-1"><a class="header-anchor" href="#上线的权衡" aria-hidden="true">#</a> 上线的权衡</h2><ol><li>上线固然好，但是特征很明显！</li><li>我们真的需要上线么？ <ul><li>上线或建立隧道（横向）</li></ul></li></ol><h2 id="webshell" tabindex="-1"><a class="header-anchor" href="#webshell" aria-hidden="true">#</a> WebShell</h2><ol><li>关于冰蝎和哥斯拉的反弹shell（内存马）</li><li>JNI</li><li>这两款工具能将ShellCode注入到JNI里，也就是内存，</li><li>这个ShellCode由JNI运行，然后这个进程有Java的签名</li><li>通俗的讲 使用Java通过内存的方式，加载了ShellCode</li><li>缺点：有一定几率使目标网站崩</li></ol><h2 id="关于隧道" tabindex="-1"><a class="header-anchor" href="#关于隧道" aria-hidden="true">#</a> 关于隧道</h2><ul><li><p>Neo-reGeorg</p></li><li><p>Frp</p></li><li><p>Nps</p></li></ul><h2 id="关于横向" tabindex="-1"><a class="header-anchor" href="#关于横向" aria-hidden="true">#</a> 关于横向</h2><ol><li>3389永远的神。</li><li>能上3389就使用密码登录上去。</li><li>使用添加用户的API去添加用户，去登录3389。</li><li>或者是找远程操控软件，进行连接登录。</li></ol><h2 id="关于内网扫描" tabindex="-1"><a class="header-anchor" href="#关于内网扫描" aria-hidden="true">#</a> 关于内网扫描</h2><ul><li>国家级演练 <ul><li>所有工具自研，主打的就是流量隐匿。</li><li>不使用市面上任何一种工具去扫描。</li><li>真正的大佬，纯粹靠手工去摸，去感触。</li><li>简单的说，就是一个BurpSuite走天下，只靠这个去发包，打一些PayLoad。</li><li>做最精准的判断，发最少的包。 <ul><li>这时安全设备有两种情况</li><li>一是检测到了，只有一条告警，蓝方会以为是误报。 <ul><li>需要说明的是，每天从安全设备经过的流量很大，蓝方不可能每一条告警都会去排查，除非是连续的告警。</li></ul></li><li>二是设备根本检测不到，你发的那一条请求。</li></ul></li><li>上去就是工具一顿扫描的，都是菜鸡！！！</li></ul></li><li>当然如果是级别不高的演练，那么还是工具一把梭！</li></ul><h2 id="关于权限维持" tabindex="-1"><a class="header-anchor" href="#关于权限维持" aria-hidden="true">#</a> 关于权限维持</h2><ul><li>打点成功后，一定要多做权限维持，留几个后门或建立隧道或者计划任务添加。</li><li>撕开口子后，查看当前服务器<strong>Mstsc</strong>的登录记录，然后就可以在内网其他服务器上做权限维持的事情。</li></ul><h2 id="关于内网打点" tabindex="-1"><a class="header-anchor" href="#关于内网打点" aria-hidden="true">#</a> 关于内网打点</h2><ol><li>拿下内网不需要很多的漏洞。</li><li>在内网中，我们需要的是密码、凭据、票据等等凭证。</li><li>拿到一台服务器，给我狠狠的翻。 <ol><li>所有盘、使用文件夹、浏览器历史记录、所有文档、中间件配置文件。</li><li>如果靠着上面的资料，拿到其他服务器，也重复这个动作，滚雪球。</li><li>请记住，把流量隐匿放在第一位，别轻易的使用工具去扫、去爆破。</li></ol></li></ol><h2 id="关于内网网段" tabindex="-1"><a class="header-anchor" href="#关于内网网段" aria-hidden="true">#</a> 关于内网网段</h2><ol><li>明确内网的存活网段很重要。</li><li>内网网段的端口不一定是原来的服务，未来的演练，SSH不一定是22端口，3389不一定是RDP服务。</li><li>还是那句话，发最少的包，确定端口开放的服务。</li><li>建议写一个自己的内网渗透工具。</li></ol><h1 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h1><p>我们不是打演练的工具人，我们应该在每一次Hvv结束后，去回忆得失。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 172859984@qq.com">Lemon_SN</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-2vfNvOO_.js" defer></script>
  </body>
</html>
